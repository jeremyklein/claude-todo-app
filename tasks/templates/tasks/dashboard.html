{% extends 'base.html' %}

{% block title %}Dashboard - Todo App{% endblock %}

{% block content %}
<h1>Dashboard</h1>

<div class="stats-grid">
    <div class="stat-card">
        <h3>Today</h3>
        <div class="stat-value">{{ points_today }}</div>
        <div class="stat-label">points</div>
    </div>
    <div class="stat-card">
        <h3>This Week</h3>
        <div class="stat-value">{{ points_week }}</div>
        <div class="stat-label">points</div>
    </div>
    <div class="stat-card">
        <h3>This Month</h3>
        <div class="stat-value">{{ points_month }}</div>
        <div class="stat-label">points</div>
    </div>
    <div class="stat-card">
        <h3>This Year</h3>
        <div class="stat-value">{{ points_year }}</div>
        <div class="stat-label">points</div>
    </div>
</div>

{% if overdue_tasks %}
<div class="section alert-section">
    <h2>Overdue Tasks</h2>
    <div class="task-list">
        {% for task in overdue_tasks %}
        <div class="task-item overdue">
            <div class="task-header">
                <h3>
                    <a href="{% url 'task_detail' task.pk %}">{{ task.title }}</a>
                    <span class="priority-badge priority-{{ task.priority }}">{{ task.get_priority_display }}</span>
                </h3>
                <span class="due-date">Due: {{ task.due_date }}</span>
            </div>
            <div class="task-meta">
                {% if task.category %}<span class="category">{{ task.category.name }}</span>{% endif %}
                <span class="effort-points">{{ task.effort_points }} pts</span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<div class="section">
    <h2>Upcoming Tasks</h2>
    {% if upcoming_tasks %}
    <div class="task-list">
        {% for task in upcoming_tasks %}
        <div class="task-item">
            <div class="task-header">
                <h3>
                    <a href="{% url 'task_detail' task.pk %}">{{ task.title }}</a>
                    <span class="priority-badge priority-{{ task.priority }}">{{ task.get_priority_display }}</span>
                </h3>
                <span class="due-date">{{ task.due_date }}</span>
            </div>
            <div class="task-meta">
                {% if task.category %}<span class="category">{{ task.category.name }}</span>{% endif %}
                <span class="effort-points">{{ task.effort_points }} pts</span>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>No upcoming tasks in the next 7 days.</p>
    {% endif %}
</div>

<div class="two-column">
    <div class="section">
        <h2>In Progress</h2>
        {% if tasks_in_progress %}
        <div class="task-list">
            {% for task in tasks_in_progress %}
            <div class="task-item">
                <h3><a href="{% url 'task_detail' task.pk %}">{{ task.title }}</a></h3>
                <div class="task-meta">
                    {% if task.category %}<span class="category">{{ task.category.name }}</span>{% endif %}
                    <span class="effort-points">{{ task.effort_points }} pts</span>
                </div>
                <div class="task-actions">
                    <a href="{% url 'task_complete' task.pk %}" class="btn btn-success btn-sm">Complete</a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>No tasks in progress.</p>
        {% endif %}
    </div>

    <div class="section">
        <h2>To Do (Top Priority)</h2>
        {% if tasks_todo %}
        <div class="task-list">
            {% for task in tasks_todo %}
            <div class="task-item">
                <h3>
                    <a href="{% url 'task_detail' task.pk %}">{{ task.title }}</a>
                    <span class="priority-badge priority-{{ task.priority }}">{{ task.get_priority_display }}</span>
                </h3>
                <div class="task-meta">
                    {% if task.category %}<span class="category">{{ task.category.name }}</span>{% endif %}
                    <span class="effort-points">{{ task.effort_points }} pts</span>
                </div>
            </div>
            {% endfor %}
        </div>
        <a href="{% url 'task_list' %}?status=todo" class="btn">View All</a>
        {% else %}
        <p>No tasks to do!</p>
        {% endif %}
    </div>
</div>

{% if tasks_completed_today %}
<div class="section">
    <h2>Completed Today</h2>
    <div class="task-list">
        {% for task in tasks_completed_today %}
        <div class="task-item completed">
            <h3><a href="{% url 'task_detail' task.pk %}">{{ task.title }}</a></h3>
            <div class="task-meta">
                {% if task.category %}<span class="category">{{ task.category.name }}</span>{% endif %}
                <span class="effort-points">{{ task.effort_points }} pts</span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if category_stats %}
<div class="section">
    <h2>Category Overview</h2>
    <table class="data-table">
        <thead>
            <tr>
                <th>Category</th>
                <th>Total Tasks</th>
                <th>Completed</th>
                <th>Completion Rate</th>
            </tr>
        </thead>
        <tbody>
            {% for cat in category_stats %}
            <tr>
                <td>{{ cat.name }}</td>
                <td>{{ cat.total_tasks }}</td>
                <td>{{ cat.completed_tasks }}</td>
                <td>{% widthratio cat.completed_tasks cat.total_tasks 100 %}%</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}
